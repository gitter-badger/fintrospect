<!DOCTYPE html><html><head><meta charset="utf8"/><title>fintrospect</title><link rel="icon" type="image/png" href="images/eye-32px.png"/><link rel="stylesheet" href="css/global.css"/><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans|Source+Code+Pro"/><script src="js/jquery/jquery.min.js"></script><script src="js/bootstrap/bootstrap.js"></script></head><body><header><nav role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button data-toggle="collapse" data-target="#navbar-top-collapse-1" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand">fintrospect</a></div><div id="navbar-top-collapse-1" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://travis-ci.org/daviddenton/fintrospect"><img src="https://travis-ci.org/daviddenton/fintrospect.svg?branch=master"/></a></li><li><a href="https://coveralls.io/github/daviddenton/fintrospect?branch=master"><img src="https://coveralls.io/repos/daviddenton/fintrospect/badge.svg?branch=master"/></a></li><li><a href="https://bintray.com/daviddenton/maven/fintrospect/_latestVersion"><img src="https://api.bintray.com/packages/daviddenton/maven/fintrospect/images/download.svg"/></a></li><li><a href="http://github.com/daviddenton/fintrospect"><img src="images/GitHub-Mark-32px.png"/></a></li></ul></div></div></nav></header><main><div class="container"><div class="row"><div class="col-sm-3"><div class="logo"><img src="images/eye.png"/></div><ul class="nav nav-pills nav-stacked nav-docs"><li class="active"><a href=".">overview</a></li><li><h1>guide</h1></li><li><a href="regarding-finagle">regarding finagle</a></li><li><a href="installation">installation</a></li><li><a href="request-parameters-and-bodies">request parameters & bodies</a></li><li><a href="routes">routes</a></li><li><a href="using-routes">using routes</a></li><li><a href="building-http-responses">building http responses</a></li><li><a href="templating-and-static-content">templating and static content</a></li><li><h1>misc</h1></li><li><a href="changelog">changelog & migration</a></li></ul></div><div class="col-sm-9"><article class="article-docs"><h1>fintrospect<p><h1 class="githubpageheader">Fintrospect</h1>
<a class="githubpageheader" href="https://travis-ci.org/daviddenton/fintrospect" target="_top"><img src="https://travis-ci.org/daviddenton/fintrospect.svg?branch=master"></a>
<a class="githubpageheader" href="https://coveralls.io/github/daviddenton/fintrospect?branch=master" target="_top"><img src="https://coveralls.io/repos/daviddenton/fintrospect/badge.svg?branch=master"></a>
<a class="githubpageheader" href="https://bintray.com/daviddenton/maven/fintrospect/_latestVersion" target="_top"><img src="https://api.bintray.com/packages/daviddenton/maven/fintrospect/images/download.svg"></a>
<a class="githubpageheader" href="https://bintray.com/daviddenton/maven/fintrospect/view?source=watch" target="_top"><img src="https://www.bintray.com/docs/images/bintray_badge_color.png"></a></p>
<p>Fintrospect a library that adds an intelligent HTTP routing layer to the 
<a href="http://twitter.github.io/finagle/" target="_top">Finagle</a> RPC framework from Twitter. It provides a simple way to 
implement contracts for both server and client-side HTTP services which are:</p>
<ul>
<li><code>Type-safe</code> : auto-marshalls all request parameters/bodies into the correct types (including primitives + JSON/XML etc...)</li>
<li><code>Auto-validating</code> : the presence of required and optional request parameters and bodies are checked before entering service-layer code</li>
<li><code>Auto-documenting</code> : runtime generation of endpoint documentation such as <a href="http://swagger.io/" target="_top">Swagger</a> JSON or web sitemap XML</li>
<li><code>Uniform</code> : reuse the same contract to define both incoming or outgoing Finagle HTTP services. This also allows extremely low effort fake servers to be created</li>
</ul>
<p>Additionally, Fintrospect provides a number of mechanisms to leverage these routes:</p>
<ul>
<li>Easily build type-safe HTTP responses with a set of custom builders for a wide variety of message formats:<ul>
<li>JSON: <a href="http://argo.sourceforge.net/" target="_top">Argo</a>, <a href="http://argonaut.io/" target="_top">Argonaut</a>, <a href="https://github.com/travisbrown/circe" target="_top">Circe</a>, <a href="https://github.com/google/gson" target="_top">GSON</a>, 
<a href="http://json4s.org/" target="_top">Json4S</a>, <a href="https://github.com/google/gson" target="_top">Play JSON</a>, <a href="https://github.com/google/gson" target="_top">Spray JSON</a></li>
<li>Native implementations of XML, Plain Text, HTML, XHTML</li>
</ul>
</li>
<li>Serve static files from the classpath</li>
<li>Template <code>View</code> support for building responses with <a href="http://mustache.github.io/" target="_top">Mustache</a> or <a href="http://handlebarsjs.com" target="_top">Handlebars</a></li>
<li>Anonymising headers for dynamic-path based endpoints, removing all dynamic path elements. This allows, for example, calls to particular endpoints to be grouped for metric purposes. e.g. 
<code>/search/author/rowling</code> becomes <code>/search/author/{name}</code></li>
<li>Utilities to help you unit-test endpoint services and write HTTP contract tests for remote dependencies </li>
</ul>
<h3>Get it</h3><p>Add the following to <code>build.sbt</code>. Note that this library doesn&#39;t depend on a particular version of Finagle, and it has built against the version below:</p>
<pre><code class="language-scala">libraryDependencies += &quot;com.twitter&quot; %% &quot;finagle-http&quot; % &quot;6.31.0&quot;
libraryDependencies += &quot;io.github.daviddenton&quot; %% &quot;fintrospect&quot; % &quot;12.0.2&quot;
</code></pre>
<p>In order to keep the core library dependency-lite, some features require additional dependencies. Please see <a href="http://fintrospect.io/installation">here</a> for details.</p>
<h3>See it</h3><p>See the <a href="https://github.com/daviddenton/fintrospect/tree/master/src/test/scala/examples/full" target="_top">example code</a>.</p>
<h3>Learn it</h3><p>See the rest of the <a href="http://fintrospect.io/" target="_top">guide</a></p>
<h4>Server-side</h4><p>Adding Fintrospect routes to a Finagle HTTP server is simple. For this example, we&#39;ll imagine a Library application (see the example above for the full code) which will be rendering Swagger v2 documentation.</p>
<h5>Define a module to live at <code>http://{host}:8080/library</code></h5><p>This module will have a single endpoint <code>search</code>:</p>
<pre><code class="language-scala">val apiInfo = ApiInfo(&quot;Library Example&quot;, &quot;1.0&quot;, Option(&quot;Simple description&quot;))
val renderer = Swagger2dot0Json(apiInfo) // choose your renderer implementation
val libraryModule = ModuleSpec(Root / &quot;library&quot;, renderer)
    .withRoute(new BookSearch(new BookRepo()).route)
val service = Module.toService(libraryModule)
Http.serve(&quot;:8080&quot;, new HttpFilter(Cors.UnsafePermissivePolicy).andThen(service)) // remember to make your own Cors Policy for prod!
</code></pre>
<h5>Define the endpoint</h5><p>This example is quite contrived (and almost all the code is optional) but shows the kind of thing that can be done. Note the use of the example response object, which will be broken down to provide the JSON model for the Swagger documentation.</p>
<pre><code class="language-scala">class BookSearch(books: Books) {
  private val maxPages = Query.optional.int(&quot;maxPages&quot;, &quot;max number of pages in book&quot;)
  private val minPages = FormField.optional.int(&quot;minPages&quot;, &quot;min number of pages in book&quot;)
  private val titleTerm = FormField.required.string(&quot;term&quot;, &quot;the part of the title to look for&quot;)
  private val form = Body.form(minPages, titleTerm)

  private def search() = Service.mk[Request, Response] { 
    request =&gt; {
      val requestForm = form.from(request)
      Ok(array(books.search(minPages.from(requestForm).getOrElse(MIN_VALUE),
        maxPages.from(request).getOrElse(MAX_VALUE),
        titleTerm.from(requestForm)).map(_.toJson)))
    }
  }

  val route = RouteSpec(&quot;search for books&quot;)
    .taking(maxPages)
    .body(form)
    .returning(Ok -&gt; &quot;we found your book&quot;, array(Book(&quot;a book&quot;, &quot;authorName&quot;, 99).toJson))
    .returning(BadRequest -&gt; &quot;invalid request&quot;)
    .producing(APPLICATION_JSON)
    .at(Post) / &quot;search&quot; bindTo search
}
</code></pre>
<h5>View the generated documentation</h5><p>The auto-generated documentation lives at the root of the module, so point the Swagger UI at <code>http://{host}:8080/library</code> to see it.</p>
<h4>Client-side</h4><p>Declare the fields to be sent to the client service and then bind them to a remote service. This produces a simple function, which can then be called with the bindings for each parameter.</p>
<pre><code class="language-scala">  val httpClient = Http.newService(&quot;localhost:10000&quot;)

  val theUser = Path.string(&quot;user&quot;)
  val gender = Header.required.string(&quot;gender&quot;)
  val theDate = FormField.required.localDate(&quot;date&quot;)
  val body = Body.form(theDate)

  val formClient = RouteSpec()
    .taking(gender)
    .body(body)
    .at(Get) / &quot;firstSection&quot; / theUser bindToClient httpClient

  val theCall = formClient(gender --&gt; &quot;female&quot;, body --&gt; Form(theDate --&gt; LocalDate.of(2015, 1, 1)), theUser --&gt; System.getenv(&quot;USER&quot;))

  println(Await.result(theCall))
</code></pre>
<h5>Test it</h5><p>Fintrospect ships with a testing trait <code>TestingFintrospectRoute</code>, which you can mix into your tests in order to validate your declared server-side routes.</p>
<h3>Upgrading?</h3><p>See the <a href="https://github.com/daviddenton/fintrospect/blob/master/CHANGELOG.md" target="_top">changelog</a>.</p>
<h3>Contributing</h3><p>If there are any message format library or templating engine bindings that you&#39;d like to see included, then please feel free to suggest them or provide a PR. For JSON formats, this
is particularly easy to implement - just provide an implementation of <code>JsonLibrary</code> by following the <code>Argo</code> example in the source.</p>
</h1></article></div></div></div></main><footer>Powered by <a href="https://github.com/jvandemo/hb-bootstrap">hb-bootstrap</a> for <a href="http://harpjs.com">Harp</a> by <a href="http://www.jvandemo.com">Jurgen Van de Moere</a></footer></body></html>